---
title: DID-based Auth Protocols
subtitle: Vurucu ve Akillica Alt Başlık  
author: Abdulhamit Kumru
date: 2020 
theme: Dresden
colortheme: dolphin
institute: Blokzincir Laboratuvarı
section-titles: false
fontsize: 10pt
---

\begin{center}
  \includegraphics[width=0.2\textwidth]{./assets/license.png}
\end{center}

\centering {License Attribution-ShareAlike 4.0 International}

### Nelerden bahsedecegiz

#### DID Core
- w3c DID Spec
- DID-common-java

#### DID Auth  
- DID TLS (Agust 2017) *unresolved*
- RWOT 2018 DID Auth (March 2018) 
  - did auth paperi
- stajda yaptiklarimiz
  - indy-auth

- did-auth-jose (October 2018, ietf, dif) *archived sept 22*
  - Javascript Object Signing and Encryption
  - jwt, jws, jwe

- DID SIOP *identity.foundation/did-siop*
  - calismalar buna odaklanmis durumda
  - sonraki bolume gecis 


### Nelerden bahsedecegiz

#### Current Auth Protocols & DID Auth
- Hali Hazirdaki Protokoller Yapilar
  - SAML
  - CAS
  - OpenID Connect

- Self-Issued OpenID Connect Provider DID Profile (did-siop, DIF)
- DID SAML ?
- DID CAS ?
- DID Authentication on PAM 

#### DID Communication ?
- Peer DID
- Aries (V1), DIF DIDcomm messaging (V2 )?


# DID Core

## SSI & DID Intro 

### Giris Slayti
!!! gereginden fazla degindigim yerler olabilir
!!! giris slayti  
!!! ikna edici bir giris hazirla  
!!! did in argumanlarini daha belirgin yap  
!!! aktif gelistirilen did methodlarindan bahset
!!! oncesi 15 daki
!!! Authentication a kadar hizli gec
!!! json ld yi iyi anla, sunumda bahset
!!! kimlik yontemlerini ozetleyen gorselleri ekle
!!! didlerin kendini ispat mekanizmalari
!!! kurumlardan bahset (w3c, dif, ietf, hypledger(linux fond.))
!!! her specteci her MUSTi kullanmadim
!!! bunu nereye eklemeli https://w3c.github.io/did-spec-registries/

### Centralised ID

\begin{center}
  \includegraphics[width=0.8\textwidth]{./assets/central_id.png}
\end{center}

### Federated ID

\begin{center}
  \includegraphics[width=0.8\textwidth]{./assets/federated_id.png}
\end{center}

### Self-Sovereign Identity (SSI)

!!! not: ssi did baglantisi acikla, notlarini al
!!! kisaca SSI ya degin

\begin{center}
  \includegraphics[width=0.8\textwidth]{./assets/ssi.png}
\end{center}

## Architecture Overview

### DID Core
!!! DID Core giris slayti
!!! bu spec hakkinda genel bilgiler  

### Four Core Properities of DID

!!! notlar ve bura uzerinde biraz dur

\begin{center}
  \includegraphics[width=0.8\textwidth]{./assets/did_core_prop.png}
\end{center}

### Architecture Overview

!!! not: bu neyi cozuyor, strongly biding ... detay ekle, strongly binding identifier and allows key rotation

\begin{center}
  \includegraphics[width=0.9\textwidth]{./assets/did_architecture_overview.png}
\end{center}


### DIDs and DID URLs
\framesubtitle{Architecture Overwiew}

!!! not: query ye detayli deginecegiz

A DID, or Decentralized Identifier, is a URI composed of three parts: ***the scheme*** "did:", a ***method identifier***, and a unique, ***method-specific identifier*** generated by the DID method.  

DIDs are resolvable to DID documents. A DID URL extends the syntax of a basic DID to incorporate other standard URI components (path, query, fragment) in order to locate a particular resource.   


### DID Format
\framesubtitle{Architecture Overwiew}

\begin{center}
  \includegraphics[width=0.9\textwidth]{./assets/did-primer-2.png}
\end{center}


### DID Subjects
\framesubtitle{Architecture Overwiew}
!!! gorsel ekle ?  

The subject of a DID is, by definition, the entity identified by the DID. The DID subject may also be the DID controller. Anything can be the subject of a DID: person, group, organization, physical thing, logical thing, etc.


### DID Controllers
\framesubtitle{Architecture Overwiew}
!!! kisalt  
!!! gorsel ekle ?  

The controller of a DID is the entity (person, organization, or autonomous software) that has the capability—as defined by a DID method—to make changes to a DID document. This capability is typically asserted by the control of a set of cryptographic keys used by software acting on behalf of the controller, though it may also be asserted via other mechanisms. Note that a DID may have more than one controller, and the DID subject can be the DID controller, or one of them.


### Verifiable Data Registries
\framesubtitle{Architecture Overwiew}
!!! kisalt  
!!! gorsel ekle ?  

In order to be resolvable to DID documents, DIDs are typically recorded on an underlying system or network of some kind. Regardless of the specific technology used, any such system that supports recording DIDs and returning data necessary to produce DID documents is called a verifiable data registry. Examples include distributed ledgers, decentralized file systems, databases of any kind, peer-to-peer networks, and other forms of trusted data storage.

### DID documents
\framesubtitle{Architecture Overwiew}
DID documents contain metadata associated with a DID. They typically express verification methods (such as public keys) and services relevant to interactions with the DID subject.


### Minimal Self-managed DID document Example
```json
{
  "@context": "https://www.w3.org/ns/did/v1",
  "id": "did:example:123456789abcdefghi",
  "authentication": [{
    "id": "did:example:123456789abcdefghi#keys-1",
    "type": "Ed25519VerificationKey2018",
    "controller": "did:example:123456789abcdefghi",
    "publicKeyBase58": "H3C2AVvLMv6gmMNam3uVAjZpfkcJCw..."
  }],
  "service": [{
    "id":"did:example:123456789abcdefghi#vcs",
    "type": "VerifiableCredentialService",
    "serviceEndpoint": "https://example.com/vc/"
  }]
}
```

### DID Methods
\framesubtitle{Architecture Overwiew}

DID methods are the mechanism by which a particular type of DID and its associated DID document are created, resolved, updated, and deactivated using a particular verifiable data registry. DID methods are defined using separate DID method specifications.

### DID resolvers and DID resolution
\framesubtitle{Architecture Overwiew}

!!! not: detayli spec linkte, burda did res. in detayina girmeyecegiz

A DID resolver is a software and/or hardware component that takes a DID (and associated input metadata) as input and produces a conforming DID document (and associated metadata) as output. This process is called DID resolution. 

*detailed spec*  w3c-ccg.github.io/did-resolution/

### DID Resolve Example
!!! gecis 

```
did:example:1234;version-id=4#keys-1 # resolves to 
```
```json
{
  "@context": "https://www.w3.org/ns/did/v1",
  "id": "did:example:123456789abcdefghi#keys-1",
  "type": "RsaVerificationKey2018",
  "publicKeyPem": "-----BEGIN PUB...0101010..END PUB -----\r\n"
}
```

## DID Core

### Identifier
!!! identifier giris slayti
!!! cevir

did ve did urllerinin syntaxini inceleyecegiz, generic terimi burda tanimlanan syntaxin diger did methodlarinda tanimlanabilecek syntaxlardan ayirtd edilmek amaciyla kullanildi

This section describes the formal syntax for DIDs and DID URLs. The term "generic" is used to differentiate the syntax defined here from syntax defined by specific DID methods in their respective specifications.

### DID Syntax
!!! not: buradaki notu not al

- The generic DID scheme is a URI scheme conformant with [RFC3988].
- The DID scheme and method name **MUST** be an ASCII lowercase string.

```
# Ethr-DID
did:ethr:0xb9c5714089478a327f09197987f16f9e5d936e8a
```

A DID is expected to be persistent and immutable. That is, a DID is bound exclusively and permanently to its one and only subject. Even after a DID is deactivated, it is intended that it never be repurposed.


### DID URL Syntax

\begin{center}
  \includegraphics[width=0.8\textwidth]{./assets/did_url.png}
\end{center}

```
did-url = did path-abempty [ "?" query ] [ "#" fragment ]
```
### DID Parameters
\framesubtitle{DID URL Syntax}

The DID URL syntax supports a simple format for parameters based on the query component. Adding a DID parameter to a DID URL means that the parameter becomes part of the identifier for a resource.


### DID Parameters
\framesubtitle{DID URL Syntax}

#### Relative Reference
A relative URI reference according to RFC3986 Section 4.2 that identifies a resource at a service endpoint, which is selected from a DID document by using the service parameter. Support for this parameter is **REQUIERED**

### Relative Reference Example
\framesubtitle{DID URL Syntax}

```json
{
  "@context": "https://www.w3.org/ns/did/v1",
  "id": "did:example:1234",
  "verificationMethod": [{
    "id": "did:example:1234#key-1",
    "type": "Ed25519VerificationKey2018",
    "controller": "did:example:1234",
    "publicKeyBase58": "H3C2AVvLMv6gmMNam3uVAjZpfkcJCwDwn..."
  }, ...],
  "authentication": [
    // relative DID URL to `did:example:1234#key-1
    "#key-1"
  ]
}
```

### DID Parameters
\framesubtitle{DID URL Syntax}

#### service parameter
Identifies a service from the DID document by service ID. Support for this parameter is **REQUIRED**

```
did:foo:21tDAKCERh95uGgKbJNHYp?service=agent
```

### DID Parameters
\framesubtitle{DID URL Syntax}

#### version-id parameter
Identifies a specific version of a DID document to be resolved (the version ID could be sequential, or a UUID, or method-specific). Support for this parameter is **OPTIONAL**

### DID Parameters
\framesubtitle{DID URL Syntax}

#### version-time parameter
Identifies a certain version timestamp of a DID document to be resolved. Support for this parameter is **OPTIONAL**

```
did:foo:21tDKJNHYp?version-time=2002-10-10T17:00:00Z
```

### DID Parameters
\framesubtitle{DID URL Syntax}

!!! not: iyi bir ozellik ama mekanizmasini tam olarak anlayamadim

#### hl patameter
A resource hash of the DID document to add integrity protection, as specified in Hashlink RFC. This parameter is *non-normative*


```
 url encoded hash link
hl:zm9YZpCjPLPJ4Epc:z3TSgXTuaHxY2ts...7DYuQ9QTPQyLHy
```


### DID URL Syntax
#### Path
A DID path is identical to a generic URI path

```
did:example:123456/path
```
#### Query
A DID query is derived from a generic URI query and **MUST** conform to DID URL Syntax rules.  

If a DID query is present, it **MUST** be used with DID Parameters.
```
did:example:123456?query=true
```

### DID URL Syntax
#### Fragment
A DID fragment is used as method-independent reference into a DID document or external resource. DID fragment syntax and semantics are identical to a generic URI fragment and **MUST** conform to RFC 3986 
```
did:example:123#agent # service endpoint
did:example:123#public-key-0 # verification method
```

#### Relative DID URLs
!!! buraya biraz daha bak
!!! ornegine deginmistik

A relative DID URL is any URL value in a DID document that does not start with `did:<method-name>:<method-specific-id>`. 
  
```json
  // ... relative DID URL to `did:example:1234#key-1`
  "authentication": [ "#key-1" ]
  // ...
```


### Example DID URLs
!!! gecis
!!! not: did url ye degin
```
# A DID URL with a 'service' DID parameter
did:foo:21tDAKCERh95uGgKbJNHYp?service=agent
# A DID URL with a 'version-time' DID parameter
did:foo:21tD...gKbJNHYp?version-time=2002-10-10T17:00:00Z

did:example:1234/
did:example:1234#keys-1
did:example:1234;version-id=4#keys-1
did:example:1234/my/path?query#fragment
did:example:1234;service=hub/my/path?query#fragment
```

### Core Properties

!!! core prop giris slayti
!!! hepsini anlatmaya gerek yok

- id
- authentication
- controller
- service
- verificationMethod
- assertionMethod
- keyAgreement
- capabilityDelegation
- capabilityInvocation

### id Property 
\framesubtitle{DID Subject}

The DID subject is denoted with the ***id*** property at the top level of a DID document.

- The DID subject is the entity that the DID document is about
- DID documents **MUST** include the id property at the top level.


```json
{
  "id": "did:example:21tDAKCERh95uGgKbJNHYp"
}
```
#### alsoKnownAs
- A DID subject can have *multiple identifiers* for different purposes, or at different times.
- The assertion that two or more DIDs (or other types of URI) identify the same DID subject can be made using the ***alsoKnownAs*** property.

### Control

!!! not: did doc may have controller, illa controller olacak diye birsey yok
!!! not:  no longer has access to their keys, or key compromise, where the DID controller's trusted third parties need to override malicious activity by an attacker. bunu anla

***Authorization*** is the mechanism used to state how operations are performed on ***behalf*** of the DID subject. ***A DID controller is authorized*** to make changes to the respective DID document.

Note: Authorization vs Authentication !

### DID Document With a Controller Property
```json
{
  "@context": "https://www.w3.org/ns/did/v1",
  "id": "did:example:123456789abcdefghi",
  "controller": "did:example:bcehfew7h32f32h7af3",
  "service": [{
    
    "type": "VerifiableCredentialService",
    "serviceEndpoint": "https://example.com/vc/"
  }]
}
```

### Verification Methods

!!! not: did controller vs verification method anla not al
!!! not: A DID document MAY include a verificationMethod property.
!!! not: cok detayli, her detaya gerek yok

A DID document can express verification methods, such as cryptographic keys, which can be used to authenticate or authorize interactions with the DID subject or associated parties. A DID document MAY include a verificationMethod property.

- The information expressed often includes globally unambiguous identifiers and public key material, which can be used to verify digital signatures.

- Verification methods might take many parameters. An example of this is a set of five cryptographic keys from which any three are required to contribute to a threshold signature.

- In order to maximize interoperability, support for public keys as verification methods is restricted

### verificationMethod Property
\framesubtitle{Verification Methods}

!!! not: cok detayli, her detaya gerek olmayabilir
!!! not: notu not al, 

- The properties **MUST** include the ***id, type, controller, and specific verification method properties*** , and MAY include additional properties.

- The value of the ***id*** property for a verification method **MUST be a URI**.

**Note: Verification method controller(s) and DID controller(s)**

As well as the ***verificationMethod*** property, verification methods can be embedded in or referenced from properties associated with various verification relationships

### Embedding and referencing verification methods

```json
{ ...  "authentication": [
  // this key is referenced
  it may be used with more than one verification relationship 
  "did:example:123456789abcdefghi#keys-1",
  // this key is embedded
  and may *only* be used for authentication
  {
    "id": "did:example:123456789abcdefghi#keys-2",
    "type": "Ed25519VerificationKey2018",
    "controller": "did:example:123456789abcdefghi",
    "publicKeyBase58": "H3C2AV...z3wXmqPV"
  }
], ... }
```


###  Key types and formats
\framesubtitle{Verification Methods}

!!! not: burada bircok issue var onlari not al

\begin{center}
  \includegraphics[width=1\textwidth]{./assets/key_types_and_formats.png}
\end{center}


### Verification Relationships
!!! not: detaylarini not al

A verification relationship expresses the relationship between the DID subject and a verification method.  

Different verification relationships enable the associated verification methods to be used for different purposes

### Verification Relationships

#### Authentication
!!! not: note u al, alt basliklarin detaylarini not al

The ***authentication***  verification relationship is used to specify how the DID subject is expected to be authenticated, such as for the purposes of logging into a website  

#### Assertion

The ***assertionMethod*** verification relationship is used to specify how the DID subject is expected to express claims, such as for the purposes of issuing a Verifiable Credential

#### Key Agreement

The ***keyAgreement***  verification relationship is used to specify how to encrypt information to the DID subject, such as for the purposes of establishing a secure communication channel with the recipient

### Verification Relationships

#### Capacity Invocation 

The ***capabilityInvocation*** verification relationship is used to specify a mechanism that might be used by the DID subject to invoke a cryptographic capability, such as the authorization to access an HTTP API

#### Capacity Delegation

The ***capabilityDelegation*** verification relationship is used to specify a mechanism that might be used by the DID subject to delegate a cryptographic capability to another party, such as delegating the authority to access a specific HTTP API to a subordinate


### Service Endpoints
!!! not: detaylari not al

Service endpoints are used in DID documents to express ways of communicating with the DID subject or associated entities. Services listed in the DID document can contain information about privacy preserving messaging services, or more public information, such as social media accounts, personal websites, and email addresses although this is discouraged  

One of the primary purposes of a DID document is to enable discovery of service endpoints. A service endpoint can be any type of service the DID subject wants to advertise, including decentralized identity management services for further discovery, authentication, authorization, or interaction

### Various service endpoints
```json
{ // ...
  "service": [{
    "id": "did:example:123456789abcdefghi#openid",
    "type": "OpenIdConnectVersion1.0Service",
    "serviceEndpoint": "https://openid.example.com/"
  }, {
    "id": "did:example:123456789abcdefghi#vcr",
    "type": "CredentialRepositoryService",
    "serviceEndpoint": "https://repository.example.com/service/8377464"
  }, {
    "id": "did:example:123456789abcdefghi#xdi",
    "type": "XdiService",
    "serviceEndpoint": "https://xdi.example.com/8377464"
  }]
// ... }
```


### Core Representations
!!! kisa gec  

All concrete representations of a DID document are serialized using a deterministic mapping that is able to be unambiguously parsed into the data model defined in this specification

Producers MUST indicate which representation of a document has been used via a media type in the document's metadata. Consumers MUST determine the representation of a DID document via the content-type DID resolver metadata field (see § 8.1 DID Resolution ), not through the content of the DID document alone.

- JSON 
- JSON-LD
- Concise Binary Object Representation (CBOR) 


### Methods
!!! giris 


### Resolution
!!! giris 


### Software / Repos
!!! did core sonu ekle
!!! repolari ekle

#### dif/did-common-java









# DID Auth

### DID Auth Giris
- DID TLS (Agust 2017) *unresolved*
- RWOT 2018 DID Auth (March 2018) 
  - did auth paperi
- stajda yaptiklarimiz
  - indy-auth

- did-auth-jose (October 2018, ietf, dif) *archived sept 22*
  - Javascript Object Signing and Encryption
  - jwt, jws, jwe

- DID SIOP *identity.foundation/did-siop*
  - calismalar buna odaklanmis durumda
  - sonraki bolume gecis 


### DIF Authentication Working Group

#### DID Authentication Profile for SIOP
This specification defines the SIOP DID AuthN flavor to use OpenID Connect (OIDC) together with the strong decentralization, privacy and security guarantees of DID for everyone who wants to have a generic way to integrate SSI wallets into their web applications.

Status: DRAFT, WIP
Use Case: Use your identity wallet to authenticate against a Web Application
Explainer
Repo

#### Encrypted Envelope
This concept is borrowed from the HL Aries project to create a standardized means of authenticated general message passing between DID controllers. DIF provides an implementation of pack/unpack that intends to meet the requirements of the DIF community.

Status: PROPOSAL
Use Case: Secure communication between DID controllers.
HL Aries Explainer
Repo








# Current Auth Protocols & DID Auth

### Current Auth Protocols & DID Auth Giris

!!! giris slayti


- Hali Hazirdaki Protokoller Yapilar
  - SAML
  - CAS
  - OpenID Connect

- Self-Issued OpenID Connect Provider DID Profile (did-siop, DIF)
- DID SAML ?
- DID CAS ?
- DID Authentication on PAM 

- protokllerin birbiri ile iliskisi
- protokollerin karsilastirilmasi
- protokollerde DIDlerin kullnailmasi

### Repositories

- decentralized-identity/did-auth-jose
- decentralized-identity/did-common-java

### Sources

- https://www.w3.org/TR/did-core/
- https://w3c-ccg.github.io/did-resolution/
- https://github.com/WebOfTrustInfo/rwot5-boston/blob/master/topics-and-advance-readings/did-primer.md
- https://github.com/WebOfTrustInfo/rwot6-santabarbara/blob/master/final-documents/
- https://docs.google.com/presentation/d/1Iv98aPWuZmRwiF01VtRjYgFHrmJGK2uOu3Iq18ALWmQ/edit#slide=id.g39c3cb0292_2_265
